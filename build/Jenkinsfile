pipeline {
    agent any 
    stages {
        stage('create eks cluster: udacity-cluster') {
            steps {
                withAWS(credentials: 'aws-creds', region: 'eu-central-1', role: 'udacity-eks-admin') {
                    sh 'ls -la /usr/local/bin'
                    sh '/usr/local/bin/eksctl version'
                    sh '/usr/local/bin/eksctl create cluster -f cluster.yaml'
                }
            }
        }
        stage('update eks config') {
            steps {
                withAWS(credentials: 'aws-creds', region: 'eu-central-1', role: 'udacity-eks-admin') {
                    sh 'aws eks update-kubeconfig --name udacity-cluster'
                }
            }
        }
    }
}