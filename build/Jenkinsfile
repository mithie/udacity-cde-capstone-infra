pipeline {
    agent any 
    environment {
        ACCOUNT_ID="173411263722"
        AWS_REGION="eu-central-1"
        EKS_ADMIN_ROLE="udacity-eks-admin-role"
        EKS_PROFILE_NAME="udacity-eks"
        CFN_STACK_NAME="udacity-eks-roles-and-permissions"
    }
    stages {
        stage('prepare aws iam') {
            steps {
                withAWS(credentials: 'aws-default-credentials', region: 'eu-central-1') {
                    sh 'cd scripts && ./prepare-iam.sh ${EKS_ADMIN_ROLE} ${EKS_PROFILE_NAME} ${CFN_STACK_NAME}'
                }
            }
        }
        stage('install udacity eks cluster') {
            steps {
                sh '''
                sleep 5
                aws sts get-caller-identity
                
                '''
            }
        }
    }
}